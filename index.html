<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>The Global Greening Inequality Explorer</title>

	<!-- D3 -->
	<script src="https://d3js.org/d3.v7.min.js"></script>

	<!-- Apple-ish minimalist style -->
	<style>
		body {
			margin: 0;
			font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
			background: #ffffff;
			color: #111;
			line-height: 1.6;
			padding: 0 20px;
		}

		header {
			padding: 60px 0 40px 0;
			text-align: center;
		}

		h1 {
			font-size: 48px;
			font-weight: 700;
			margin-bottom: 10px;
			letter-spacing: -0.5px;
		}

		h2 {
			font-size: 32px;
			margin-top: 60px;
			font-weight: 600;
			color: #111;
		}

		.subtitle {
			color: #555;
			font-size: 22px;
			margin-top: 5px;
			font-weight: 400;
		}

		p {
			max-width: 900px;
			margin: 16px auto;
			font-size: 18px;
			color: #222;
		}

		#viz-container {
			max-width: 900px;
			margin: 40px auto;
			padding: 20px 0;
		}

		#linechart {
			width: 100%;
			height: 500px;
		}

		.tooltip {
			position: absolute;
			padding: 8px 12px;
			background: #000;
			color: #fff;
			border-radius: 6px;
			font-size: 14px;
			pointer-events: none;
			opacity: 0;
			transition: 0.15s ease-out;
		}

		.caption {
			text-align: center;
			font-size: 16px;
			color: #666;
			margin-top: 10px;
		}

		footer {
			margin: 80px 0 40px 0;
			text-align: center;
			font-size: 16px;
			color: #777;
		}
	</style>
</head>

<body>

	<header>
		<h1>The Global Greening Inequality Explorer</h1>
		<div class="subtitle">NDVI Trends Across World Income Groups (2000–2024)</div>
	</header>

	<!-- INTRO -->
	<section id="intro">
		<p>
			This explorable explanation investigates whether global “greening” — measured using NDVI — is occurring
			uniformly across world income groups, or whether a greening inequality gap is forming. This prototype shows
			our first interactive visualization: NDVI percent-change trajectories since 2000 for high-income,
			upper-middle-income, and lower-middle-income groups.
		</p>
	</section>

	<!-- VISUALIZATION -->
	<section id="viz-container">
		<h2>NDVI Percent Change vs Baseline (2000–2024)</h2>
		<div class="subtitle">Interactive Prototype Visualization</div>

		<svg id="linechart"></svg>
		<div class="caption">Hover to explore NDVI percent-change trends by income group.</div>
	</section>

	<!-- WRITEUP -->
	<section id="writeup">
		<h2>Initial Prototype Writeup</h2>
		<p>
			We have assembled preliminary NDVI time-series data for the three major income groups and created simulated
			percent-change values so we can begin prototyping our visual encodings. We designed the structure of our
			explorable explanation, including sections for trends, comparisons, inequality metrics, and climate drivers
			such as rainfall. For the prototype, we implemented our first interactive D3 visualization: a multi-line
			chart showing NDVI percent change for high-income, upper-middle-income, and lower-middle-income groups from
			2000 to 2024. We also built the skeleton of our webpage, set up GitHub Pages hosting, and added placeholder
			sections for the additional visualizations we will build later.
		</p>

		<p>
			The biggest challenge will be building a polished, multi-view interactive dashboard where several linked
			visualizations update simultaneously. Our dataset involves time series, income groups, rainfall
			measurements, and derived inequality indicators such as the Greening Wealth Gap Index, so designing
			coordinated interactions without overwhelming the user will be complex. In particular, ensuring that
			filtering or highlighting in one view updates the heatmap, scatterplot, and time-series charts smoothly will
			require careful planning and debugging. Another challenge will be maintaining visual clarity and avoiding
			expressiveness violations as we encode inequality narratives that must remain accessible to non-technical
			audiences.
		</p>
	</section>

	<footer>
		© 2025 VizWizards — DSC 106 Final Project Prototype
	</footer>

	<!-- TOOLTIP -->
	<div class="tooltip" id="tooltip"></div>

	<!-- D3 SCRIPT -->
<script>
/*** Simulated NDVI percent-change data (same as before) ***/
const years = d3.range(2000, 2025);

const data = [];
years.forEach((year, i) => {
  data.push(
    { year, income: "High income", pct: -0.5 + i * 0.25 },
    { year, income: "Upper-middle income", pct: -0.7 + i * 0.27 },
    { year, income: "Lower-middle income", pct: -1.0 + i * 0.32 }
  );
});

const svg = d3.select("#linechart");
const width = svg.node().getBoundingClientRect().width;
const height = svg.node().getBoundingClientRect().height;

const margin = { top: 40, right: 80, bottom: 50, left: 60 };
const chartWidth = width - margin.left - margin.right;
const chartHeight = height - margin.top - margin.bottom;

const g = svg.append("g")
  .attr("transform", `translate(${margin.left}, ${margin.top})`);

const x = d3.scaleLinear()
  .domain(d3.extent(years))
  .range([0, chartWidth]);

const y = d3.scaleLinear()
  .domain([d3.min(data, d => d.pct) - 1, d3.max(data, d => d.pct) + 1])
  .range([chartHeight, 0]);

/**** Color mapping ****/
const color = d3.scaleOrdinal()
  .domain(["High income", "Upper-middle income", "Lower-middle income"])
  .range(["#007aff", "#2dd1ac", "#f9c00c"]);

/**** Group the data by income ****/
const groups = d3.groups(data, d => d.income);

/**** Line generator ****/
const line = d3.line()
  .x(d => x(d.year))
  .y(d => y(d.pct))
  .curve(d3.curveMonotoneX);

/**** Draw the vertical "Paris Agreement" line ****/
g.append("line")
  .attr("x1", x(2015))
  .attr("x2", x(2015))
  .attr("y1", 0)
  .attr("y2", chartHeight)
  .attr("stroke", "#cc79a7")
  .attr("stroke-dasharray", "5,5")
  .attr("stroke-width", 2);

/**** Draw all lines ****/
const lines = g.selectAll(".line")
  .data(groups)
  .enter()
  .append("path")
  .attr("class", "line")
  .attr("fill", "none")
  .attr("stroke", d => color(d[0]))
  .attr("stroke-width", 3)
  .attr("d", d => line(d[1]));

/**** Axes ****/
g.append("g")
  .attr("transform", `translate(0,${chartHeight})`)
  .call(d3.axisBottom(x).tickFormat(d3.format("d")));

g.append("g")
  .call(d3.axisLeft(y));

/**** Tooltip ****/
const tooltip = d3.select("#tooltip");

/**** Create a tracking circle for each line ****/
const hoverGroups = g.selectAll(".hover-group")
  .data(groups)
  .enter()
  .append("g")
  .attr("class", "hover-group");

hoverGroups.append("circle")
  .attr("r", 6)
  .attr("fill", d => color(d[0]))
  .attr("stroke", "#fff")
  .attr("stroke-width", 2)
  .style("opacity", 0);

/**** Track mouse movement ****/
svg.on("mousemove", function(event) {
  const [mouseX, mouseY] = d3.pointer(event);

  // Convert mouse position -> year
  const yearScale = x.invert(mouseX - margin.left);
  const closestYear = Math.round(yearScale);

  if (closestYear < 2000 || closestYear > 2024) {
    tooltip.style("opacity", 0);
    hoverGroups.selectAll("circle").style("opacity", 0);
    return;
  }

  // Update each hover circle
  hoverGroups.each(function([incName, values]) {
    const v = values.find(d => d.year === closestYear);
    if (!v) return;
    d3.select(this).select("circle")
      .attr("cx", x(v.year))
      .attr("cy", y(v.pct))
      .style("opacity", 1);
  });

  // Tooltip content
  const rows = groups.map(([incName, values]) => {
    const v = values.find(d => d.year === closestYear);
    return `<div><span style="color:${color(incName)}">●</span> ${incName}: <b>${v.pct.toFixed(1)}%</b></div>`;
  }).join("");

  tooltip.style("opacity", 1)
    .style("left", `${mouseX + 20}px`)
    .style("top", `${mouseY + 20}px`)
    .html(`
      <strong>${closestYear}</strong>
      <br/>
      ${rows}
    `);
});

svg.on("mouseleave", () => {
  tooltip.style("opacity", 0);
  hoverGroups.selectAll("circle").style("opacity", 0);
});
</script>

</body>

</html>